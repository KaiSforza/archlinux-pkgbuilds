# Maintainer: Swen Simon <swsimon at gmail dot com>
# Contributor: William Giokas <1007380@gmail.com>

DLORIG=${DLAGENTS[@]}
DLAGENTS=('http::/usr/bin/curl -qb "" -flC - --retry 3 --retry-delay 3 -o %o --user-agent "Mozilla/4.0" %u'
        ${DLORIG[@]})

pkgname=epsxe
pkgver=1.6.0
pkgrel=10
pkgdesc="Enhanced PSX emulator"
url="http://epsxe.com"
arch=('i686' 'x86_64')

[ "$CARCH" == "i686" ] && depends=(gtk)
[ "$CARCH" == "x86_64" ] && depends=(lib32-gtk lib32-ncurses lib32-libxt)

makedepends=('unzip')
license=('custom')
install=epsxe.install
options=(!strip)

source=(http://www.epsxe.com/files/epsxe160lin.zip \
        http://www.epsxe.com/files/epsxe152lin.zip \
        epsxe.desktop \
        epsxe.png) 

md5sums=('32704cfc77939b9a1bd047f22b70eca2' \
         '5834f34cb904b08d95abda057eff3981' \
         '087234e20ae9147f83df24b69fc93bca' \
         'eb0c46b8ae1355c589792f6be1835e47')

package() {
  cd $srcdir
  
  # extract archives
  unzip -qqo -d 1.6.0 epsxe160lin.zip
  unzip -qqo -d 1.5.2 epsxe152lin.zip

  # removing junk files
  find 1.6.0 -name "*.me" -exec rm -f {} \;

  mkdir -p $pkgdir/opt/epsxe
  mkdir -p $pkgdir/usr/share/licenses/epsxe

  # copying binaries
  cp -r $srcdir/1.6.0/* $pkgdir/opt/epsxe
  cp $srcdir/1.5.2/epsxe $pkgdir/opt/epsxe/epsxe-1.5.2

  cd $pkgdir/opt/epsxe

  # installing files
  cp $srcdir/docs/* $pkgdir/usr/share/licenses/epsxe/
  install -D -m644 $startdir/epsxe.desktop ${pkgdir}/usr/share/applications/epsxe.desktop || return 1
  install -D -m644 $startdir/epsxe.png ${pkgdir}/usr/share/pixmaps/epsxe.png || return 1

  # permissions
  if [ -z `egrep -i "^games" /etc/group` ]; then
    echo "You have to add games group with uid 50 manually"
  fi

  chown -R root:50 $pkgdir/opt/epsxe
  chmod 755 $pkgdir/opt/epsxe
  find * -type f -exec chmod 664 {} \;
  find * -type d -exec chmod 775 {} \;
  find epsxe* -type f -exec chmod 755 {} \;
}
